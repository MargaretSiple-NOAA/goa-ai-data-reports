---
output:
  officedown::rdocx_document: 
    reference_docx: styles_reference2.docx
    pandoc_args: ["--metadata-file=header.yaml"]
csl: "../cite/citestyle.csl"
bibliography: "../cite/bibliography.bib"
---

This is a test of the cross-refs in this doc (Table \@ref(tab:stations-allocated)). And here is a test for figure cross-referencing (Figure \@ref(fig:area-map)).

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE)
library(officedown)
library(officer)
```

```{r echo=FALSE}
# THESE STATIC VALUES ARE ALL FOR TESTING
# library(magrittr)
# #maxyr <- 2022
# #nth <- "10th"
# nfish <- 360 #UPDATE THESE
# ninverts <- 151
# nstations <- 390
# highest_total_catch <- c("Pacific cod (Gadus chalcogrammus),
#                          Arrowtooth flounder (Atherestes stomias)")
# # character vector. FIX and make list of species
# vessel1 <- "F/V Ocean Explorer"
# vessel2 <- "F/V Sea Storm"
# dates_conducted <- c("June 16th, 2022", "August 17th, 2022")
# 
# output_date <- "2022-08-24"
# load(here::here("output",paste(output_date),"figures","report_figures.rdata"))
# load(here::here("output",paste(output_date),"tables","report_tables.rdata"))

```

# Preface
```{r child=here::here("gdrive","Preface.Rmd")}
```

# Abstract
```{r child=here::here("gdrive","Abstract.Rmd")}
```

# Introduction
```{r child=here::here("gdrive","Introduction.Rmd")}
```

# Methods
```{r child=here::here("gdrive","Methods.Rmd")}
```

<!-- Tables -->
```{r tab.cap='Stations allocated and sampled this year.', tab.id='stations-allocated',  tab.cap.style = "Table Caption"}
list_tables[[1]]
```

--
  
```{r tab.cap='Target numbers of length samples for each managed species.', tab.id='length-sample-sizes',  tab.cap.style = "Table Caption"}
list_tables[[2]]
```



```{r tab.cap='Number of otoliths collected by INPFC area and depth range.', tab.id='otolith-sample-summary',  tab.cap.style = "Table Caption"}
otos_collected
```

<!-- Figures -->
```{r fig.cap='Map of the Aleutian Islands 2018 bottom trawl survey area indicating survey districts (WAI = Western Aleutian Islands, CAI = Central Aleutian Islands, EAI = Eastern Aleutian Islands, and SBS = Southern Bering Sea), isobaths from 100â€“500 m and stations sampled (black dots).', fig.id='area-map',  fig.cap.style = "Figure Caption"}
include_graphics(here::here(img1_path))
```

<!-- NOTE: Figures after this first one are all per species until the appendix. -->


# Results

This section contains one chapter for each species. 

```{r, echo=FALSE, results='asis'}
# report_species contains the list of species in the report 
src <- list()

for(i in 1:6){
  species_code <- report_species$species_code[i]
  spp_name_informal <- report_species$spp_name_informal[i]
  spp_name_scientific <- report_species$spp_name_scientific[i]
  middle_sentences <- " THESE ARE THE MIDDLE SENTENCES" #middle_sentences[i]
  year <- maxyr
  region <- survname_long
  
  xx <- filter(top_CPUE,
                     species_code==species_code & INPFC_AREA %in% c("Central Aleutians",
                                                                    "Eastern Aleutians",
                                                                    "Southern Bering Sea",
                                                                    "Western Aleutians")) %>% # Subset only to the areas
    dplyr::top_n(n = 2,wt = wgted_mean_cpue_kgha) %>% 
    dplyr::select(INPFC_AREA)
  
  top_cpue_vec <- xx[[1]]
  
  table3 <- table3s_list[[as.character(species_code)]]
  
  src[[i]] <- knitr::knit_expand(here::here('markdown','SpeciesResultTemplate.Rmd'))
}

res = knitr::knit_child(text = unlist(src), quiet = TRUE)
cat(res, sep = '\n')
```

